//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: build/src/main/java/com/adiron/busme/platform/RequestUpdater.java
//
//  Created by polar on 5/25/13.
//

#import "IOSClass.h"
#import "com/adiron/busme/api/APIBase.h"
#import "com/adiron/busme/integration/http/NameValuePair.h"
#import "com/adiron/busme/platform/ActivityAPI.h"
#import "com/adiron/busme/platform/Handler.h"
#import "com/adiron/busme/platform/Log.h"
#import "com/adiron/busme/platform/RequestUpdater.h"
#import "java/io/IOException.h"
#import "java/util/ArrayList.h"
#import "java/util/Date.h"
#import "java/util/Iterator.h"
#import "java/util/List.h"

@implementation ComAdironBusmePlatformRequestUpdater

static NSString * ComAdironBusmePlatformRequestUpdater_LOGTAG_;

- (ComAdironBusmePlatformActivityAPI *)activityAPI {
  return activityAPI_;
}
- (void)setActivityAPI:(ComAdironBusmePlatformActivityAPI *)activityAPI {
  JreOperatorRetainedAssign(&activityAPI_, activityAPI);
}
@synthesize activityAPI = activityAPI_;
@synthesize please_stop = please_stop_;
- (id<JavaUtilList>)argumentPreparers {
  return argumentPreparers_;
}
- (void)setArgumentPreparers:(id<JavaUtilList>)argumentPreparers {
  JreOperatorRetainedAssign(&argumentPreparers_, argumentPreparers);
}
@synthesize argumentPreparers = argumentPreparers_;
- (id<JavaUtilList>)responseProcessors {
  return responseProcessors_;
}
- (void)setResponseProcessors:(id<JavaUtilList>)responseProcessors {
  JreOperatorRetainedAssign(&responseProcessors_, responseProcessors);
}
@synthesize responseProcessors = responseProcessors_;
- (NSString *)requestUrl {
  return requestUrl_;
}
- (void)setRequestUrl:(NSString *)requestUrl {
  JreOperatorRetainedAssign(&requestUrl_, requestUrl);
}
@synthesize requestUrl = requestUrl_;
- (id<ComAdironBusmePlatformRequestUpdater_UpdateProgressListener>)updateProgressListener {
  return updateProgressListener_;
}
- (void)setUpdateProgressListener:(id<ComAdironBusmePlatformRequestUpdater_UpdateProgressListener>)updateProgressListener {
  JreOperatorRetainedAssign(&updateProgressListener_, updateProgressListener);
}
@synthesize updateProgressListener = updateProgressListener_;

+ (NSString *)LOGTAG {
  return ComAdironBusmePlatformRequestUpdater_LOGTAG_;
}

- (ComAdironBusmePlatformHandler *)getBackgroundHandler {
  return [((ComAdironBusmePlatformActivityAPI *) NIL_CHK(activityAPI_)) getBackgroundHandler];
}

- (id)initWithComAdironBusmePlatformActivityAPI:(ComAdironBusmePlatformActivityAPI *)api {
  if ((self = [super init])) {
    please_stop_ = YES;
    JreOperatorRetainedAssign(&argumentPreparers_, [[[JavaUtilArrayList alloc] init] autorelease]);
    JreOperatorRetainedAssign(&responseProcessors_, [[[JavaUtilArrayList alloc] init] autorelease]);
    self.activityAPI = api;
  }
  return self;
}

- (int)getUpdateRate {
  return [((ComAdironBusmePlatformActivityAPI *) NIL_CHK(activityAPI_)) getUpdateRate];
}

- (void)startUpdate {
  [ComAdironBusmePlatformLog dWithNSString:ComAdironBusmePlatformRequestUpdater_LOGTAG_ withNSString:@"startUpdate:"];
  please_stop_ = NO;
}

- (void)resumeUpdate {
  [ComAdironBusmePlatformLog dWithNSString:ComAdironBusmePlatformRequestUpdater_LOGTAG_ withNSString:@"resumeUpdate:"];
  please_stop_ = NO;
  if ([self getBackgroundHandler] == nil) {
    return;
  }
  [[self getBackgroundHandler] postWithJavaLangRunnable:self];
}

- (void)suspendUpdate {
  [ComAdironBusmePlatformLog dWithNSString:ComAdironBusmePlatformRequestUpdater_LOGTAG_ withNSString:@"suspendUpdate:"];
  please_stop_ = YES;
  if ([self getBackgroundHandler] == nil) {
    return;
  }
  [[self getBackgroundHandler] removeCallbacksWithJavaLangRunnable:self];
}

- (void)stopUpdate {
  [ComAdironBusmePlatformLog dWithNSString:ComAdironBusmePlatformRequestUpdater_LOGTAG_ withNSString:@"stopUpdate:"];
  if ([self getBackgroundHandler] == nil) {
    return;
  }
  [[self getBackgroundHandler] removeCallbacksWithJavaLangRunnable:self];
  please_stop_ = YES;
}

- (void)addArgumentPreparerWithComAdironBusmePlatformRequestUpdater_ArgumentsPreparer:(id<ComAdironBusmePlatformRequestUpdater_ArgumentsPreparer>)p {
  [((id<JavaUtilList>) NIL_CHK(argumentPreparers_)) addWithId:p];
}

- (void)addResponseProcessorWithComAdironBusmePlatformRequestUpdater_ResponseProcessor:(id<ComAdironBusmePlatformRequestUpdater_ResponseProcessor>)p {
  [((id<JavaUtilList>) NIL_CHK(responseProcessors_)) addWithId:p];
}

- (NSString *)getRequestUrl {
  return requestUrl_;
}

- (void)setRequestUrlWithNSString:(NSString *)requestUrl {
  self.requestUrl = requestUrl;
}

- (id<ComAdironBusmePlatformRequestUpdater_UpdateProgressListener>)getUpdateProgressListener {
  return updateProgressListener_;
}

- (void)setUpdateProgressListenerWithComAdironBusmePlatformRequestUpdater_UpdateProgressListener:(id<ComAdironBusmePlatformRequestUpdater_UpdateProgressListener>)updateProgressListener {
  self.updateProgressListener = updateProgressListener;
}

- (void)updateWithComAdironBusmePlatformRequestUpdater_UpdateProgressListener:(id<ComAdironBusmePlatformRequestUpdater_UpdateProgressListener>)progressListener
                                                                     withBOOL:(BOOL)forced {
  if (progressListener != nil) {
    [progressListener onUpdateStartWithJavaUtilDate:[[[JavaUtilDate alloc] init] autorelease] withBOOL:forced];
  }
  NSString *requestUrl = [self getRequestUrl];
  BOOL makeRequest = NO;
  if (requestUrl != nil) {
    if (progressListener != nil) {
      [progressListener onArgumentsStart];
    }
    id<JavaUtilList> parameters = [[[JavaUtilArrayList alloc] init] autorelease];
    {
      id<JavaUtilIterator> iter__ = ((id<JavaUtilIterator>) [((id<JavaUtilList>) NIL_CHK(argumentPreparers_)) iterator]);
      while ([((id<JavaUtilIterator>) NIL_CHK(iter__)) hasNext]) {
        id<ComAdironBusmePlatformRequestUpdater_ArgumentsPreparer> p = ((id<ComAdironBusmePlatformRequestUpdater_ArgumentsPreparer>) [((id<JavaUtilIterator>) NIL_CHK(iter__)) next]);
        id<JavaUtilList> args = [((id<ComAdironBusmePlatformRequestUpdater_ArgumentsPreparer>) NIL_CHK(p)) getArguments];
        if (args != nil) {
          [((id<JavaUtilList>) NIL_CHK(parameters)) addAllWithJavaUtilCollection:args];
          makeRequest = YES;
        }
      }
    }
    if (progressListener != nil) {
      [progressListener onArgumentsFinishWithBOOL:makeRequest];
    }
    ComAdironBusmeApiAPIBase_Tag *response = nil;
    if (makeRequest) {
      if (progressListener != nil) {
        [progressListener onRequestStartWithJavaUtilDate:[[[JavaUtilDate alloc] init] autorelease]];
      }
      @try {
        response = [((ComAdironBusmePlatformActivityAPI *) NIL_CHK(activityAPI_)) postAndParseTagWithNSString:[self getRequestUrl] withJavaUtilList:parameters];
      }
      @catch (JavaIoIOException *e) {
        [((JavaIoIOException *) NIL_CHK(e)) printStackTrace];
        if (progressListener != nil) {
          [progressListener onRequestIOErrorWithJavaIoIOException:e];
        }
      }
      if (progressListener != nil) {
        [progressListener onRequestFinishWithJavaUtilDate:[[[JavaUtilDate alloc] init] autorelease]];
      }
      if (progressListener != nil) {
        [progressListener onResponseStart];
      }
      {
        id<JavaUtilIterator> iter__ = ((id<JavaUtilIterator>) [((id<JavaUtilList>) NIL_CHK(responseProcessors_)) iterator]);
        while ([((id<JavaUtilIterator>) NIL_CHK(iter__)) hasNext]) {
          id<ComAdironBusmePlatformRequestUpdater_ResponseProcessor> rp = ((id<ComAdironBusmePlatformRequestUpdater_ResponseProcessor>) [((id<JavaUtilIterator>) NIL_CHK(iter__)) next]);
          [((id<ComAdironBusmePlatformRequestUpdater_ResponseProcessor>) NIL_CHK(rp)) processResponseWithComAdironBusmeApiAPIBase_Tag:response];
        }
      }
      if (progressListener != nil) {
        [progressListener onResponseFinish];
      }
    }
  }
  if (progressListener != nil) {
    [progressListener onUpdateFinishWithBOOL:makeRequest withJavaUtilDate:[[[JavaUtilDate alloc] init] autorelease]];
  }
}

- (void)run {
  [self updateWithComAdironBusmePlatformRequestUpdater_UpdateProgressListener:[self getUpdateProgressListener] withBOOL:NO];
  if (!please_stop_) {
    ComAdironBusmePlatformHandler *handler = [self getBackgroundHandler];
    if (handler == nil) {
      return;
    }
    [((ComAdironBusmePlatformHandler *) NIL_CHK(handler)) postDelayedWithJavaLangRunnable:self withLongInt:[self getUpdateRate]];
  }
}

- (void)forceUpdate {
  [self forceUpdateWithComAdironBusmePlatformRequestUpdater_UpdateProgressListener:[self getUpdateProgressListener]];
}

- (void)forceUpdateWithComAdironBusmePlatformRequestUpdater_UpdateProgressListener:(id<ComAdironBusmePlatformRequestUpdater_UpdateProgressListener>)listener {
  ComAdironBusmePlatformHandler *handler = [self getBackgroundHandler];
  if (handler == nil) {
    return;
  }
  [((ComAdironBusmePlatformHandler *) NIL_CHK(handler)) postWithJavaLangRunnable:[[[ComAdironBusmePlatformRequestUpdater_$1 alloc] initWithComAdironBusmePlatformRequestUpdater:self withComAdironBusmePlatformRequestUpdater_UpdateProgressListener:listener] autorelease]];
}

+ (void)initialize {
  if (self == [ComAdironBusmePlatformRequestUpdater class]) {
    JreOperatorRetainedAssign(&ComAdironBusmePlatformRequestUpdater_LOGTAG_, [[IOSClass classWithClass:[ComAdironBusmePlatformRequestUpdater class]] getName]);
  }
}

- (void)dealloc {
  JreOperatorRetainedAssign(&updateProgressListener_, nil);
  JreOperatorRetainedAssign(&requestUrl_, nil);
  JreOperatorRetainedAssign(&responseProcessors_, nil);
  JreOperatorRetainedAssign(&argumentPreparers_, nil);
  JreOperatorRetainedAssign(&activityAPI_, nil);
  [super dealloc];
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  ComAdironBusmePlatformRequestUpdater *typedCopy = (ComAdironBusmePlatformRequestUpdater *) copy;
  typedCopy.activityAPI = activityAPI_;
  typedCopy.please_stop = please_stop_;
  typedCopy.argumentPreparers = argumentPreparers_;
  typedCopy.responseProcessors = responseProcessors_;
  typedCopy.requestUrl = requestUrl_;
  typedCopy.updateProgressListener = updateProgressListener_;
}

@end
@implementation ComAdironBusmePlatformRequestUpdater_UpdateProgressListenerBase

- (void)onUpdateStartWithJavaUtilDate:(JavaUtilDate *)time
                             withBOOL:(BOOL)forced {
}

- (void)onArgumentsStart {
}

- (void)onArgumentsFinishWithBOOL:(BOOL)makeRequest {
}

- (void)onRequestStartWithJavaUtilDate:(JavaUtilDate *)time {
}

- (void)onRequestIOErrorWithJavaIoIOException:(JavaIoIOException *)e {
}

- (void)onRequestFinishWithJavaUtilDate:(JavaUtilDate *)time {
}

- (void)onResponseStart {
}

- (void)onResponseFinish {
}

- (void)onUpdateFinishWithBOOL:(BOOL)madeRequest
              withJavaUtilDate:(JavaUtilDate *)time {
}

- (id)init {
  return [super init];
}

- (void)dealloc {
  [super dealloc];
}

@end
@implementation ComAdironBusmePlatformRequestUpdater_$1

- (ComAdironBusmePlatformRequestUpdater *)this$0 {
  return this$0_;
}
- (void)setThis$0:(ComAdironBusmePlatformRequestUpdater *)this$0 {
  JreOperatorRetainedAssign(&this$0_, this$0);
}
@synthesize this$0 = this$0_;
- (id<ComAdironBusmePlatformRequestUpdater_UpdateProgressListener>)val$listener {
  return val$listener_;
}
- (void)setVal$listener:(id<ComAdironBusmePlatformRequestUpdater_UpdateProgressListener>)val$listener {
  JreOperatorRetainedAssign(&val$listener_, val$listener);
}
@synthesize val$listener = val$listener_;

- (void)run {
  [this$0_ updateWithComAdironBusmePlatformRequestUpdater_UpdateProgressListener:val$listener_ withBOOL:YES];
}

- (id)initWithComAdironBusmePlatformRequestUpdater:(ComAdironBusmePlatformRequestUpdater *)outer$
withComAdironBusmePlatformRequestUpdater_UpdateProgressListener:(id<ComAdironBusmePlatformRequestUpdater_UpdateProgressListener>)capture$0 {
  if ((self = [super init])) {
    JreOperatorRetainedAssign(&this$0_, outer$);
    JreOperatorRetainedAssign(&val$listener_, capture$0);
  }
  return self;
}

- (void)dealloc {
  JreOperatorRetainedAssign(&val$listener_, nil);
  JreOperatorRetainedAssign(&this$0_, nil);
  [super dealloc];
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  ComAdironBusmePlatformRequestUpdater_$1 *typedCopy = (ComAdironBusmePlatformRequestUpdater_$1 *) copy;
  typedCopy.this$0 = this$0_;
  typedCopy.val$listener = val$listener_;
}

@end
