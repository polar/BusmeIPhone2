//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: build/src/main/java/com/adiron/busme/platform/JourneyStore.java
//
//  Created by polar on 5/25/13.
//

#import "IOSClass.h"
#import "IOSObjectArray.h"
#import "com/adiron/busme/api/JourneyPattern.h"
#import "com/adiron/busme/api/Route.h"
#import "com/adiron/busme/platform/ActivityAPI.h"
#import "com/adiron/busme/platform/JourneyStore.h"
#import "com/adiron/busme/platform/Log.h"
#import "java/util/Collection.h"
#import "java/util/HashMap.h"
#import "java/util/Iterator.h"
#import "java/util/List.h"
#import "java/util/Map.h"

@implementation ComAdironBusmePlatformJourneyStore

static NSString * ComAdironBusmePlatformJourneyStore_LOGTAG_;

- (id<JavaUtilMap>)patterns {
  return patterns_;
}
- (void)setPatterns:(id<JavaUtilMap>)patterns {
  JreOperatorRetainedAssign(&patterns_, patterns);
}
@synthesize patterns = patterns_;
- (id<JavaUtilMap>)journeys {
  return journeys_;
}
- (void)setJourneys:(id<JavaUtilMap>)journeys {
  JreOperatorRetainedAssign(&journeys_, journeys);
}
@synthesize journeys = journeys_;

+ (NSString *)LOGTAG {
  return ComAdironBusmePlatformJourneyStore_LOGTAG_;
}

- (ComAdironBusmeApiJourneyPattern *)getPatternWithNSString:(NSString *)id_ {
  return ((ComAdironBusmeApiJourneyPattern *) [((id<JavaUtilMap>) NIL_CHK(patterns_)) getWithId:id_]);
}

- (void)storeJourneyWithComAdironBusmeApiRoute:(ComAdironBusmeApiRoute *)route {
  @synchronized(self) {
    {
      [ComAdironBusmePlatformLog dWithNSString:ComAdironBusmePlatformJourneyStore_LOGTAG_ withNSString:[NSString stringWithFormat:@"storeJourney: id= %@ %@ version= %qi", [((ComAdironBusmeApiRoute *) NIL_CHK(route)) getId], [((ComAdironBusmeApiRoute *) NIL_CHK(route)) getName], [((ComAdironBusmeApiRoute *) NIL_CHK(route)) getVersion]]];
      if ([((ComAdironBusmeApiRoute *) NIL_CHK(route)) isJourney]) {
        ComAdironBusmeApiJourneyPattern *pattern = [((ComAdironBusmeApiRoute *) NIL_CHK(route)) getJourneyPatternWithInt:0];
        if (pattern != nil) {
          [((id<JavaUtilMap>) NIL_CHK(patterns_)) putWithId:[pattern getId] withId:pattern];
        }
        else {
          [ComAdironBusmePlatformLog dWithNSString:ComAdironBusmePlatformJourneyStore_LOGTAG_ withNSString:@"Incomplete Journey, missing pattern. Not storing."];
          return;
        }
      }
      if ([((ComAdironBusmeApiRoute *) NIL_CHK(route)) isRouteDefinition]) {
        id<JavaUtilList> pids = [((ComAdironBusmeApiRoute *) NIL_CHK(route)) getPatternIds];
        for (int i = 0; i < [((id<JavaUtilList>) NIL_CHK(pids)) size]; i++) {
          if (![((id<JavaUtilMap>) NIL_CHK(patterns_)) containsKeyWithId:((NSString *) [((id<JavaUtilList>) NIL_CHK(pids)) getWithInt:i])]) {
            ComAdironBusmeApiJourneyPattern *pattern = [((ComAdironBusmeApiRoute *) NIL_CHK(route)) getJourneyPatternWithInt:i];
            if (pattern != nil) {
              [((id<JavaUtilMap>) NIL_CHK(patterns_)) putWithId:[pattern getId] withId:pattern];
            }
            else {
              [ComAdironBusmePlatformLog dWithNSString:ComAdironBusmePlatformJourneyStore_LOGTAG_ withNSString:@"Incomplete Journey, missing pattern. Not storing."];
              return;
            }
          }
        }
      }
      [((id<JavaUtilMap>) NIL_CHK(journeys_)) putWithId:[((ComAdironBusmeApiRoute *) NIL_CHK(route)) getId] withId:route];
    }
  }
}

- (ComAdironBusmeApiRoute *)getJourneyWithNSString:(NSString *)id_ {
  @synchronized(self) {
    {
      ComAdironBusmeApiRoute *route = ((ComAdironBusmeApiRoute *) [((id<JavaUtilMap>) NIL_CHK(journeys_)) getWithId:id_]);
      if (route == nil) {
        [ComAdironBusmePlatformLog dWithNSString:ComAdironBusmePlatformJourneyStore_LOGTAG_ withNSString:[NSString stringWithFormat:@"getJourney(%@) == null" , id_, nil]];
      }
      else {
        if ([route isJourney] && [route getJourneyPatternWithInt:0] == nil) {
          if ([((ComAdironBusmeApiRoute *) NIL_CHK(route)) getPatternId] != nil) {
            ComAdironBusmeApiJourneyPattern *pattern = ((ComAdironBusmeApiJourneyPattern *) [((id<JavaUtilMap>) NIL_CHK(patterns_)) getWithId:[((ComAdironBusmeApiRoute *) NIL_CHK(route)) getPatternId]]);
            if (pattern != nil) {
              [((ComAdironBusmeApiRoute *) NIL_CHK(route)) setJourneyPatternWithInt:0 withComAdironBusmeApiJourneyPattern:pattern];
            }
            else {
              return nil;
            }
          }
        }
        if ([route isRouteDefinition]) {
          id<JavaUtilList> pids = [route getPatternIds];
          for (int i = 0; i < [((id<JavaUtilList>) NIL_CHK(pids)) size]; i++) {
            if ([((ComAdironBusmeApiRoute *) NIL_CHK(route)) getJourneyPatternWithInt:i] == nil) {
              ComAdironBusmeApiJourneyPattern *pattern = ((ComAdironBusmeApiJourneyPattern *) [((id<JavaUtilMap>) NIL_CHK(patterns_)) getWithId:((NSString *) [((id<JavaUtilList>) NIL_CHK(pids)) getWithInt:i])]);
              if (pattern != nil) {
                [((ComAdironBusmeApiRoute *) NIL_CHK(route)) setJourneyPatternWithInt:i withComAdironBusmeApiJourneyPattern:((ComAdironBusmeApiJourneyPattern *) [((id<JavaUtilMap>) NIL_CHK(patterns_)) getWithId:((NSString *) [((id<JavaUtilList>) NIL_CHK(pids)) getWithInt:i])])];
              }
              else {
                return nil;
              }
            }
          }
        }
        [ComAdironBusmePlatformLog dWithNSString:ComAdironBusmePlatformJourneyStore_LOGTAG_ withNSString:[NSString stringWithFormat:@"getJourney(%@) = version= %d, name=%@" , id_, [route getVersion], [route getName], nil]];
      }
      return ((ComAdironBusmeApiRoute *) [((id<JavaUtilMap>) NIL_CHK(journeys_)) getWithId:id_]);
    }
  }
}

- (void)removeJourneyWithComAdironBusmeApiRoute:(ComAdironBusmeApiRoute *)route {
  @synchronized(self) {
    {
      [ComAdironBusmePlatformLog dWithNSString:ComAdironBusmePlatformJourneyStore_LOGTAG_ withNSString:[NSString stringWithFormat:@"removeJourney( = version= %d, name=%@" , [((ComAdironBusmeApiRoute *) NIL_CHK(route)) getVersion], [((ComAdironBusmeApiRoute *) NIL_CHK(route)) getName], nil]];
      [((id<JavaUtilMap>) NIL_CHK(journeys_)) removeWithId:route];
    }
  }
}

- (void)postSerializeWithId:(ComAdironBusmePlatformActivityAPI *)busAPI {
  @synchronized(self) {
    {
      {
        id<JavaUtilIterator> iter__ = ((id<JavaUtilIterator>) [((id<JavaUtilCollection>) [((id<JavaUtilMap>) NIL_CHK(journeys_)) values]) iterator]);
        while ([((id<JavaUtilIterator>) NIL_CHK(iter__)) hasNext]) {
          ComAdironBusmeApiRoute *route = ((ComAdironBusmeApiRoute *) [((id<JavaUtilIterator>) NIL_CHK(iter__)) next]);
          [((ComAdironBusmeApiRoute *) NIL_CHK(route)) postSerializeWithComAdironBusmePlatformActivityAPI:busAPI];
        }
      }
    }
  }
}

- (void)preSerializeWithId:(ComAdironBusmePlatformActivityAPI *)busAPI {
  @synchronized(self) {
    {
      {
        id<JavaUtilIterator> iter__ = ((id<JavaUtilIterator>) [((id<JavaUtilCollection>) [((id<JavaUtilMap>) NIL_CHK(journeys_)) values]) iterator]);
        while ([((id<JavaUtilIterator>) NIL_CHK(iter__)) hasNext]) {
          ComAdironBusmeApiRoute *route = ((ComAdironBusmeApiRoute *) [((id<JavaUtilIterator>) NIL_CHK(iter__)) next]);
          [((ComAdironBusmeApiRoute *) NIL_CHK(route)) preSerialize];
        }
      }
    }
  }
}

- (id)init {
  if ((self = [super init])) {
    JreOperatorRetainedAssign(&patterns_, [[[JavaUtilHashMap alloc] init] autorelease]);
    JreOperatorRetainedAssign(&journeys_, [[[JavaUtilHashMap alloc] init] autorelease]);
  }
  return self;
}

+ (void)initialize {
  if (self == [ComAdironBusmePlatformJourneyStore class]) {
    JreOperatorRetainedAssign(&ComAdironBusmePlatformJourneyStore_LOGTAG_, [[IOSClass classWithClass:[ComAdironBusmePlatformJourneyStore class]] getName]);
  }
}

- (void)dealloc {
  JreOperatorRetainedAssign(&journeys_, nil);
  JreOperatorRetainedAssign(&patterns_, nil);
  [super dealloc];
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  ComAdironBusmePlatformJourneyStore *typedCopy = (ComAdironBusmePlatformJourneyStore *) copy;
  typedCopy.patterns = patterns_;
  typedCopy.journeys = journeys_;
}

@end
