//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: build/src/main/java/com/adiron/busme/platform/MarkersRequestProcessor.java
//
//  Created by polar on 5/25/13.
//

#import "IOSClass.h"
#import "IOSObjectArray.h"
#import "com/adiron/busme/api/APIBase.h"
#import "com/adiron/busme/api/MarkerInfo.h"
#import "com/adiron/busme/integration/GeoPoint.h"
#import "com/adiron/busme/integration/http/NameValuePair.h"
#import "com/adiron/busme/integration/http/message/BasicNameValuePair.h"
#import "com/adiron/busme/platform/Log.h"
#import "com/adiron/busme/platform/MarkerBasket.h"
#import "com/adiron/busme/platform/MarkersRequestProcessor.h"
#import "java/lang/Double.h"
#import "java/lang/Exception.h"
#import "java/lang/Integer.h"
#import "java/lang/Long.h"
#import "java/util/ArrayList.h"
#import "java/util/Collection.h"
#import "java/util/HashMap.h"
#import "java/util/Iterator.h"
#import "java/util/List.h"
#import "java/util/Map.h"

@implementation ComAdironBusmePlatformMarkersRequestProcessor

static NSString * ComAdironBusmePlatformMarkersRequestProcessor_LOGTAG_;

- (ComAdironBusmePlatformMarkerBasket *)markerBasket {
  return markerBasket_;
}
- (void)setMarkerBasket:(ComAdironBusmePlatformMarkerBasket *)markerBasket {
  JreOperatorRetainedAssign(&markerBasket_, markerBasket);
}
@synthesize markerBasket = markerBasket_;
- (id<ComAdironBusmePlatformMarkersRequestProcessor_OnMarkersResponseListener>)responseListener {
  return responseListener_;
}
- (void)setResponseListener:(id<ComAdironBusmePlatformMarkersRequestProcessor_OnMarkersResponseListener>)responseListener {
  JreOperatorRetainedAssign(&responseListener_, responseListener);
}
@synthesize responseListener = responseListener_;

+ (NSString *)LOGTAG {
  return ComAdironBusmePlatformMarkersRequestProcessor_LOGTAG_;
}

- (id)init {
  return [super init];
}

- (id)initWithComAdironBusmePlatformMarkerBasket:(ComAdironBusmePlatformMarkerBasket *)markerBasket
withComAdironBusmePlatformMarkersRequestProcessor_OnMarkersResponseListener:(id<ComAdironBusmePlatformMarkersRequestProcessor_OnMarkersResponseListener>)responseListener {
  if ((self = [super init])) {
    [self setMarkerBasketWithComAdironBusmePlatformMarkerBasket:markerBasket];
    [self setResponseListenerWithComAdironBusmePlatformMarkersRequestProcessor_OnMarkersResponseListener:responseListener];
  }
  return self;
}

- (ComAdironBusmePlatformMarkerBasket *)getMarkerBasket {
  return markerBasket_;
}

- (void)setMarkerBasketWithComAdironBusmePlatformMarkerBasket:(ComAdironBusmePlatformMarkerBasket *)markerBasket {
  self.markerBasket = markerBasket;
}

- (id<ComAdironBusmePlatformMarkersRequestProcessor_OnMarkersResponseListener>)getResponseListener {
  return responseListener_;
}

- (void)setResponseListenerWithComAdironBusmePlatformMarkersRequestProcessor_OnMarkersResponseListener:(id<ComAdironBusmePlatformMarkersRequestProcessor_OnMarkersResponseListener>)responseListener {
  self.responseListener = responseListener;
}

- (void)processResponseWithComAdironBusmeApiAPIBase_Tag:(ComAdironBusmeApiAPIBase_Tag *)response {
  id<JavaUtilMap> markers = nil;
  if (response != nil && ((ComAdironBusmeApiAPIBase_Tag *) NIL_CHK(response)).childNodes != nil) {
    {
      id<JavaUtilIterator> iter__ = ((id<JavaUtilIterator>) [((id<JavaUtilList>) NIL_CHK(response.childNodes)) iterator]);
      while ([((id<JavaUtilIterator>) NIL_CHK(iter__)) hasNext]) {
        ComAdironBusmeApiAPIBase_Tag *tag = ((ComAdironBusmeApiAPIBase_Tag *) [((id<JavaUtilIterator>) NIL_CHK(iter__)) next]);
        if ([@"Markers" isEqual:((ComAdironBusmeApiAPIBase_Tag *) NIL_CHK(tag)).name]) {
          [ComAdironBusmePlatformLog dWithNSString:ComAdironBusmePlatformMarkersRequestProcessor_LOGTAG_ withNSString:[NSString stringWithFormat:@"getMarkerXML: GOT %d Elements", [((id<JavaUtilList>) NIL_CHK(tag.childNodes)) size]]];
          markers = [[[JavaUtilHashMap alloc] initWithInt:[((id<JavaUtilList>) NIL_CHK(tag.childNodes)) size]] autorelease];
          if ([((id<JavaUtilList>) NIL_CHK(tag.childNodes)) size] > 0) {
            [ComAdironBusmePlatformLog dWithNSString:ComAdironBusmePlatformMarkersRequestProcessor_LOGTAG_ withNSString:[NSString stringWithFormat:@"getMarkersXML: GOT markers %@", tag]];
            [ComAdironBusmePlatformLog dWithNSString:ComAdironBusmePlatformMarkersRequestProcessor_LOGTAG_ withNSString:[NSString stringWithFormat:@"getMarkersXML: GOT %d Markers", [((id<JavaUtilList>) NIL_CHK(tag.childNodes)) size]]];
            {
              id<JavaUtilIterator> iter__ = ((id<JavaUtilIterator>) [((id<JavaUtilList>) NIL_CHK(tag.childNodes)) iterator]);
              while ([((id<JavaUtilIterator>) NIL_CHK(iter__)) hasNext]) {
                ComAdironBusmeApiAPIBase_Tag *n = ((ComAdironBusmeApiAPIBase_Tag *) [((id<JavaUtilIterator>) NIL_CHK(iter__)) next]);
                if ([@"Marker" isEqual:((ComAdironBusmeApiAPIBase_Tag *) NIL_CHK(n)).name]) {
                  NSString *id_ = ((NSString *) [((id<JavaUtilMap>) NIL_CHK(n.attributes)) getWithId:@"id"]);
                  if (((NSString *) [((id<JavaUtilMap>) NIL_CHK(n.attributes)) getWithId:@"destroy"]) != nil) {
                    [((id<JavaUtilMap>) NIL_CHK(markers)) putWithId:id_ withId:nil];
                  }
                  else {
                    @try {
                      ComAdironBusmeApiMarkerInfo *marker = [[[ComAdironBusmeApiMarkerInfo alloc] init] autorelease];
                      ((ComAdironBusmeApiMarkerInfo *) NIL_CHK(marker)).id_ = id_;
                      int lat = (int) ([JavaLangDouble parseDoubleWithNSString:((NSString *) [((id<JavaUtilMap>) NIL_CHK(n.attributes)) getWithId:@"lat"])] * 1E6);
                      int lon = (int) ([JavaLangDouble parseDoubleWithNSString:((NSString *) [((id<JavaUtilMap>) NIL_CHK(n.attributes)) getWithId:@"lon"])] * 1E6);
                      ((ComAdironBusmeApiMarkerInfo *) NIL_CHK(marker)).radius = [JavaLangLong parseLongWithNSString:((NSString *) [((id<JavaUtilMap>) NIL_CHK(n.attributes)) getWithId:@"radius"])];
                      ((ComAdironBusmeApiMarkerInfo *) NIL_CHK(marker)).goUrl = ((NSString *) [((id<JavaUtilMap>) NIL_CHK(n.attributes)) getWithId:@"go_url"]);
                      ((ComAdironBusmeApiMarkerInfo *) NIL_CHK(marker)).iconUrl = ((NSString *) [((id<JavaUtilMap>) NIL_CHK(n.attributes)) getWithId:@"icon_url"]);
                      ((ComAdironBusmeApiMarkerInfo *) NIL_CHK(marker)).version_ = [JavaLangInteger parseIntWithNSString:((NSString *) [((id<JavaUtilMap>) NIL_CHK(n.attributes)) getWithId:@"version"])];
                      ((ComAdironBusmeApiMarkerInfo *) NIL_CHK(marker)).point = [[[ComAdironBusmeIntegrationGeoPoint alloc] initWithInt:lat withInt:lon] autorelease];
                      {
                        id<JavaUtilIterator> iter__ = ((id<JavaUtilIterator>) [((id<JavaUtilList>) NIL_CHK(n.childNodes)) iterator]);
                        while ([((id<JavaUtilIterator>) NIL_CHK(iter__)) hasNext]) {
                          ComAdironBusmeApiAPIBase_Tag *m = ((ComAdironBusmeApiAPIBase_Tag *) [((id<JavaUtilIterator>) NIL_CHK(iter__)) next]);
                          if ([@"Title" isEqual:((ComAdironBusmeApiAPIBase_Tag *) NIL_CHK(m)).name]) {
                            ((ComAdironBusmeApiMarkerInfo *) NIL_CHK(marker)).title = ((ComAdironBusmeApiAPIBase_Tag *) NIL_CHK(m)).text;
                          }
                          else if ([@"Description" isEqual:((ComAdironBusmeApiAPIBase_Tag *) NIL_CHK(m)).name]) {
                            ((ComAdironBusmeApiMarkerInfo *) NIL_CHK(marker)).description_ = ((ComAdironBusmeApiAPIBase_Tag *) NIL_CHK(m)).text;
                          }
                        }
                      }
                      [((id<JavaUtilMap>) NIL_CHK(markers)) putWithId:((ComAdironBusmeApiMarkerInfo *) NIL_CHK(marker)).id_ withId:marker];
                    }
                    @catch (JavaLangException *e) {
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  }
  if (markers != nil) {
    [((id<ComAdironBusmePlatformMarkersRequestProcessor_OnMarkersResponseListener>) [self getResponseListener]) onResponseWithJavaUtilMap:markers];
  }
}

- (id<JavaUtilList>)getArguments {
  ComAdironBusmePlatformMarkerBasket *basket = [self getMarkerBasket];
  if (basket != nil) {
    id<JavaUtilCollection> collection = [basket getMarkers];
    [ComAdironBusmePlatformLog dWithNSString:ComAdironBusmePlatformMarkersRequestProcessor_LOGTAG_ withNSString:[NSString stringWithFormat:@"getArguments() %@ markers" , [((id<JavaUtilCollection>) NIL_CHK(collection)) size], nil]];
    id<JavaUtilList> params = [[[JavaUtilArrayList alloc] initWithInt:[((id<JavaUtilCollection>) NIL_CHK(collection)) size]] autorelease];
    {
      id<JavaUtilIterator> iter__ = ((id<JavaUtilIterator>) [((id<JavaUtilCollection>) NIL_CHK(collection)) iterator]);
      while ([((id<JavaUtilIterator>) NIL_CHK(iter__)) hasNext]) {
        ComAdironBusmeApiMarkerInfo *j = ((ComAdironBusmeApiMarkerInfo *) [((id<JavaUtilIterator>) NIL_CHK(iter__)) next]);
        [((id<JavaUtilList>) NIL_CHK(params)) addWithId:[[[ComAdironBusmeIntegrationHttpMessageBasicNameValuePair alloc] initWithNSString:@"marker_ids[]" withNSString:((ComAdironBusmeApiMarkerInfo *) NIL_CHK(j)).id_] autorelease]];
        [((id<JavaUtilList>) NIL_CHK(params)) addWithId:[[[ComAdironBusmeIntegrationHttpMessageBasicNameValuePair alloc] initWithNSString:@"marker_versions[]" withNSString:[NSString stringWithFormat:@"%d", ((ComAdironBusmeApiMarkerInfo *) NIL_CHK(j)).version_]] autorelease]];
      }
    }
    return params;
  }
  else {
    return nil;
  }
}

+ (void)initialize {
  if (self == [ComAdironBusmePlatformMarkersRequestProcessor class]) {
    JreOperatorRetainedAssign(&ComAdironBusmePlatformMarkersRequestProcessor_LOGTAG_, [[IOSClass classWithClass:[ComAdironBusmePlatformMarkersRequestProcessor class]] getName]);
  }
}

- (void)dealloc {
  JreOperatorRetainedAssign(&responseListener_, nil);
  JreOperatorRetainedAssign(&markerBasket_, nil);
  [super dealloc];
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  ComAdironBusmePlatformMarkersRequestProcessor *typedCopy = (ComAdironBusmePlatformMarkersRequestProcessor *) copy;
  typedCopy.markerBasket = markerBasket_;
  typedCopy.responseListener = responseListener_;
}

@end
